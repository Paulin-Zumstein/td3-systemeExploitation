#include "../commun/td3.h"


extern char* NOM_FICHIERS[PALETTE_SIZE];
extern char ALPHABET_PALETTE[PALETTE_SIZE];
extern Handler HANDLER_TABLE[PALETTE_SIZE];



//choix de la palette a utiliser
char* palette_courante = ALPHABET_PALETTE;


void codage(int entre){	
	unsigned char position = 0;
    char carac;
    while(read(entre, &carac, 1)) { //lecture caractere par caractere du fichier entre
        carac = tolower(carac);
        putchar(carac); 
        int sorti = open(get_filename_for_char(carac), O_CREAT | O_WRONLY | O_APPEND, 0644); //creation ou ouverture d'un ficher .in correspondant au carac en question
        write(sorti, &position, 1); // ecriture de la position du caratere dans le fichier
        position++; //incrementation de la position
        close(sorti);
 
    }
}

void decodage(int sorti){
    for(int i=0; i < PALETTE_SIZE; i++) { //parcours de la palette de lettres 
        unsigned char position;
        int l = open(NOM_FICHIERS[i], O_RDONLY, 0644); //ouverture du fichier correspondant au caractere
        while(read(l, &position, 1) > 0) { //lecture des positions du caractere
            lseek(sorti, position, SEEK_SET); //placement du curseur Ã  la bonne position dans le fichier sorti
            HANDLER_TABLE[i](sorti); //ecriture du caractere dans le fichier sorti
        }
        close(l);
    }
    close(sorti);
}
